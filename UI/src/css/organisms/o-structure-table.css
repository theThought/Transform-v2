o-loop {
    display: block;
}

body.focus-question o-loop:has(o-response:focus-within) {
    box-shadow: var(--box-shadow);
}

.o-structure-table {
    --color-stripe: var(--color-light2);

    colgroup[data-question-group] {
        border-inline-end: var(--border-thickness) solid var(--color-darkest);

        &:last-of-type {
            border-inline-end: none;
        }
    }

    tbody,
    tr,
    td,
    th {
        vertical-align: revert;
    }

    td,
    th {
        padding: var(--space-1);
    }

    th {
        font-weight: normal;
    }

    thead:not(:empty) + tbody,
    tr.m-structure-row-heading + tr:not(.m-structure-row-heading),
    tr.m-structure-caption-row + tr.m-structure-row {
        border-block-start: var(--border-thickness) solid var(--color-darkest);
    }

    &.shade-header-column {
        th {
            background-color: var(--color-stripe);
            border-end-start-radius: var(--border-radius);
            border-start-start-radius: var(--border-radius);
        }
    }

    &.shade-alt-columns {
        td:nth-child(even),
        th:nth-child(even) {
            background-color: var(--color-stripe);
        }

        tr:first-child td,
        tr:first-child th {
            border-start-end-radius: var(--border-radius);
            border-start-start-radius: var(--border-radius);
        }

        tr:last-child td {
            border-end-end-radius: var(--border-radius);
            border-end-start-radius: var(--border-radius);
        }
    }

    &.shade-header-row {
        th[scope='col'],
        td[scope='col'] {
            background-color: var(--color-stripe);
            border-start-end-radius: var(--border-radius);
            border-start-start-radius: var(--border-radius);
        }
    }

    &.shade-alt-rows {
        tr.striped {
            td,
            th {
                background-color: var(--color-stripe);
            }

            td:first-child,
            th:first-child {
                border-end-start-radius: var(--border-radius);
                border-start-start-radius: var(--border-radius);
            }

            td:last-child {
                border-end-end-radius: var(--border-radius);
                border-start-end-radius: var(--border-radius);
            }
        }

        tr.m-structure-row-error.striped {
            td,
            th {
                border-end-end-radius: 0;
                border-end-start-radius: 0;
            }
        }

        tr.striped + tr.striped {
            td:first-child,
            th:first-child {
                border-start-start-radius: 0;
            }

            td:last-child {
                border-start-end-radius: 0;
            }
        }
    }

    .m-grid-total {
        display: inline-flex;

        .a-label-pre,
        .a-label-post {
            background-color: transparent;
            border-color: transparent;
        }
    }

    .align-default {
        text-align: center;
    }

    .align-left {
        text-align: start;
    }

    .align-right {
        text-align: end;
    }

    :where(.grid-column-total-title, .grid-column-total, .grid-grandtotal) {
        border-block-start: var(--border-thickness) solid var(--color-darkest);
        font-size: var(--font-size-m);
    }

    :where(.grid-row-total-title, .grid-row-total, .grid-grandtotal) {
        border-inline-start: var(--border-thickness) solid var(--color-darkest);
        font-size: var(--font-size-m);
    }

    :where(.grid-row-total, .grid-grandtotal) {
        text-align: end;
    }

    :where(.grid-row-total, .grid-column-total, .grid-grandtotal) {
        white-space: nowrap;
    }

    :where(.grid-grandtotal) {
        padding-block-start: 0.5em;
    }

    caption {
        caption-side: top;
        margin-block-end: 0.5em;
        text-align: start;
    }
}
